---
title: "滑らかなスラロームの設計② 設計方法"
date: "2020-04-25T12:00:00+09:00"
categories:
  - "説明記事"
tags:
  - "マイクロマウス"
  - "制御"
thumbnail: "icon.png"
draft: true
---

前回の記事の続きです．

この記事では，滑らかなスラローム軌道の具体的な設計方法を紹介します．

<!--more-->

## 手順の概要

今回のスラローム設計は，事前の軌道設計と走行時の適用に分けて考えることができます．

1. 事前にコンピュータで**スラローム軌道の形状**を設計する
2. 走行時にそのときの並進速度を用いて，**軌道をスケーリング**する

まずはじめに，それぞれの概要を説明します．

### 事前の形状設計の概要

スラローム走行をするときには，ターンの角度や移動距離などさまざまな拘束条件があります．

事前の形状設計では，それらを満たすような軌道の形状を設計します．

このときに，スラローム前後に追加する直線の長さも決定します．

### 走行時のスケーリングの概要

事前設計したスラローム形状は，設計した並進速度と角速度を同時に適用して走行したときに実現する形状です．

走行時には，事前設計したスラロームの形状をそのときの並進速度で走行するために適切にスケーリングします．

こうすることで，任意の並進速度でターンに差し掛かったとしても，その並進速度を維持した状態でターンをすることができます．

## 事前の概形設計

それでは，具体的な設計方法を説明します．

例えば，以下のような，探索90度ターンの軌道を設計する場合を考えます．

ターンの前後には，5 mm の直線が追加されています．

![スラローム形状](slalom_xy.svg)

### 座標のとり方

今回の記事では，$x-y$座標系を考え，初期状態の機体進行方向を $x$軸にとります．

姿勢角 $\theta$ は，$x$軸となす角を表します．

つまり，前進すると$x$座標が正になり，左折をすると$y$座標と角度$\theta$が正になり，右折ならば負になるという形です．

### 与える情報

ここで，今回スラローム形状を設計する上で必要な拘束条件を列挙します．

| 項目                | 変数                    | 探索45度ターンの例     | 備考                       |
| ------------------- | ----------------------- | ---------------------- | -------------------------- |
| 移動位置            | $(x_e,~y_e)$            | (45, 45) [mm]          | 前後の追加直線を含めた変位 |
| 移動角度            | $\theta_e$              | $\pi/2$ [rad]          | ターンの角度               |
| 曲線部分の $y$ 成分 | $y_c$                   | 40 [mm]                | 前後の追加直線の調整に使用 |
| 最大角躍度          | $\dddot{\theta}_{\max}$ | 1200 $\pi$ [rad/s/s/s] | 応答を見ながら調整         |
| 最大角加速度        | $\ddot{\theta}_{\max}$  | 36 $\pi$ [rad/s/s]     | 応答を見ながら調整         |
| 最大角速度          | $\dot{\theta}_{\max}$   | 3 $\pi$ [rad/s]        | 応答を見ながら調整         |

### 得られる情報

次に，事前設計によって得られる情報です．

| 項目         | 変数             | 探索45度ターンの例 | 備考                     |
| ------------ | ---------------- | ------------------ | ------------------------ |
| 曲線変位     | $(x_c,~y_c)$     | (40, 40) [mm]      | カーブ部分の変位         |
| 旋回前直線長 | $l_1$            | 5 [mm]             | カーブ前の追加直線の長さ |
| 旋回後直線長 | $l_2$            | 5 [mm]             | カーブ後の追加直線の長さ |
| 基準並進速度 | $v_\mathrm{ref}$ | 241.59 [mm/s]      | カーブ後の追加直線の長さ |

### 導出手順

1. スラロームの最大角躍度，最大角加速度，最大角速度を設定する
2. 角度の拘束を満たす角速度分布 $\omega(t)$ を求める
3. 適当に並進速度 $v_0$ を与え，位置 $(x,y)$ 数値積分をして終点位置を求める
4. 積分結果をもとに，移動位置を目標位置になるように並進速度 $v_0$ をスケーリングして基準並進速度 $v_\mathrm{ref}$ を得る
5. 求まった基準並進速度 $v_\mathrm{ref}$ および角速度分布が求めるスラロームの概形となる

### 手順

1. 最大角躍度，最大角加速度，最大角速度を決定する
2. [滑らかな加速の設計](/posts/2018-04-29-accel-designer1)の方法により，各時刻 $t$ における速度分布などを生成する．
3. 基準速度 $v$ ルンゲクッタ法で積分し，位置を得る．

![角速度分布](slalom_t.svg)

## 走行時のスケーリング方法

1. 走行する並進速度$v$を用いて，積分結果が事前設計の概形になるような角速度$\omega(t)$を算出する．
2. 並進速度 $v$ と求めた角速度 $\omega(t)$ で走行する．
3. 各時刻で数値積分を行うことで，目標位置 $x, y, \theta$ が得られる．
4. 任意の方法でフィードバック制御を行う．

## まとめ

与える情報と得られる情報をまとめると，次にようになります．

### 設計時に与える情報

- 最大角躍度 $\dddot{\theta}_{\max}$
- 最大角躍度 $\ddot{\theta}_{\max}$
- 最大角躍度 $\dot{\theta}_{\max}$
- 角度 $\theta_{\rm end}$
- 位置 $x_{\rm end},~ y_{\rm end}$

### 設計時に得られる情報

- 基準並進速度 $v_{\rm ref}$

### 走行時に与える情報

- 並進速度 $v$

### 走行時に得られる情報

- 任意の時刻 $t$ における以下の値
  - 角躍度 $\dddot{\theta}(t)$
  - 角加速度 $\ddot{\theta}(t)$
  - 角速度 $\dot{\theta}(t)$
  - 角度 $\theta(t)$
  - 位置 $x(t)$, $y(t)$

## まとめ

今回の記事では，滑らかなスラローム軌道の設計方法について述べました．

次回の記事では，C++による実装例を紹介します．

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
